-----------------------------------------------------------
1_QLHSUT_schema: tạo db
2_QLHSUT_user: tạo user, role cho db, cấp quyền cho user
3_Proc_Func_Trig: các proc, func, trig được sử dụng cho app
-----------------------------------------------------------

Các thông tin cập nhật hay thông tin muốn cập nhật về database, vui lòng cập nhật trong file này:
- Tạo 1 store procedure USER_LOGIN phục vụ login
6/7/24:
- Thêm các proc xử lý đăng ký đăng tuyển cho doanh nghiệp:
CREATE OR REPLACE PROCEDURE QLHSUT.DN_THEM_TTDT
    (V_MADN NUMBER, V_VITRI NVARCHAR2, V_SOLUONG NUMBER, V_MOTA NVARCHAR2, V_YEUCAU NVARCHAR2, V_MADANGTUYEN OUT NUMBER)
AS
    V_MADT NUMBER;
    V_COUNT NUMBER;
BEGIN     
    LOOP
        SELECT FLOOR(DBMS_RANDOM.VALUE(10000, 99999)) INTO V_MADT FROM dual;
        SELECT COUNT(*) INTO V_COUNT FROM QLHSUT.QLHSUT_THONG_TIN_DANG_TUYEN WHERE MADT = V_MADT;
        IF V_COUNT = 0 THEN
            EXIT;
        END IF;
    END LOOP;
    INSERT INTO QLHSUT.QLHSUT_THONG_TIN_DANG_TUYEN VALUES (V_MADT, V_MADN, V_VITRI, V_SOLUONG, V_MOTA, V_YEUCAU);
    V_MADANGTUYEN := V_MADT;
END;
/

CREATE OR REPLACE PROCEDURE QLHSUT.DN_THEM_MAHD
    (V_MADT NUMBER, V_MAHOPDONG OUT NUMBER)
AS
    V_MAHD NUMBER;
    V_COUNT NUMBER;
BEGIN     
    LOOP
        SELECT FLOOR(DBMS_RANDOM.VALUE(10000, 99999)) INTO V_MAHD FROM dual;
        SELECT COUNT(*) INTO V_COUNT FROM QLHSUT.QLHSUT_HOP_DONG_DANG_TUYEN WHERE MAHOPDONG = V_MAHD;
        IF V_COUNT = 0 THEN
            EXIT;
        END IF;
    END LOOP;
    INSERT INTO QLHSUT.QLHSUT_HOP_DONG_DANG_TUYEN(MAHOPDONG, MADT) VALUES (V_MAHD, V_MADT);
    V_MAHOPDONG := V_MAHD;
END;
/

CREATE OR REPLACE PROCEDURE QLHSUT.DN_THEM_PHIEUQC
    (V_MAHD NUMBER, V_NGAYBD VARCHAR2, V_NGAYKT VARCHAR2)
AS
    V_MAPQC NUMBER;
    V_COUNT NUMBER;
BEGIN     
    LOOP
        SELECT FLOOR(DBMS_RANDOM.VALUE(10000, 99999)) INTO V_MAPQC FROM dual;
        SELECT COUNT(*) INTO V_COUNT FROM QLHSUT.QLHSUT_PHIEU_QUANG_CAO WHERE MAPQC = V_MAPQC;
        IF V_COUNT = 0 THEN
            EXIT;
        END IF;
    END LOOP;
    INSERT INTO QLHSUT.QLHSUT_PHIEU_QUANG_CAO(MAPQC, MAHOPDONG, TG_BATDAU, TG_KETTHUC) VALUES (V_MAPQC, V_MAHD, TO_DATE(V_NGAYBD, 'dd-MM-yyyy'), TO_DATE(V_NGAYKT, 'dd-MM-yyyy'));
END;
/

CREATE OR REPLACE PROCEDURE QLHSUT.DN_THEM_HINHTHUCDT
    (V_MAHD NUMBER, V_TENHINHTHUC NVARCHAR2)
AS
    V_MAHT NUMBER;
BEGIN     
    SELECT MAHT INTO V_MAHT FROM QLHSUT.QLHSUT_HINH_THUC_DANG_TUYEN WHERE TENHINHTHUC = V_TENHINHTHUC;
    IF V_MAHT IS NOT NULL THEN
        INSERT INTO QLHSUT.QLHSUT_HINH_THUC_LUA_CHON(MAHOPDONG, MAHT) VALUES (V_MAHD, V_MAHT);
    END IF;
END;
/
- Cấp quyền thêm cho user:
GRANT EXECUTE ANY PROCEDURE TO RL_QLHSUT_NHANVIEN;
GRANT EXECUTE ON dbms_random TO RL_QLHSUT_NHANVIEN;
GRANT EXECUTE ANY PROCEDURE TO RL_QLHSUT_UNGVIEN;
GRANT EXECUTE ON dbms_random TO RL_QLHSUT_UNGVIEN;
GRANT EXECUTE ANY PROCEDURE TO RL_QLHSUT_DOANHNGHIEP;
GRANT EXECUTE ON dbms_random TO RL_QLHSUT_DOANHNGHIEP;


Văn:
- Bảng hợp đồng: thêm trường TINHTRANG = {đã duyệt, chưa duyệt, gia hạn}
- Bảng hồ sơ ứng tuyển: 0 -> Chưa duyệt, -1 -> thiếu hồ sơ, >0 -> Đã duyệt
